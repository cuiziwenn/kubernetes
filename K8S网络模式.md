## Kubernetes网络模式
#### 集群内：
* 容器与容器之间的通信
* Pod和Pod之间的通信
* Pod和服务之间的通信
#### 集群外
* 外部应用与服务之间的通信

因此，Kubernetes假设Pod之间能够进行通讯，这些Pod可能部署在不同的宿主机上。每一个Pod都拥有自己的IP地址，因此能够将Pod看作为物理主机或者虚拟机，从而能实现端口设置、命名、服务发现、负载均衡、应用配置和迁移。为了满足上述需求，则需要通过集群网络来实现。

####  同一个Pod中容器之间的通信
* 根据Kubernetes的架构设计。Kubernetes创建Pod时，首先会创建一个pause容器，为Pod指派一个唯一的IP地址。然后，以pause的网络命名空间为基础，创建同一个Pod内的其它容器（–net=container:xxx）。因此，同一个Pod内的所有容器就会共享同一个网络命名空间，在同一个Pod之间的容器可以直接使用localhost进行通信。
#### 不同Pod中容器之间的通信
* Kubernetes通过flannel、calic等网络插件解决Pod间的通信问题。
#### Flannel网络
* Flannel是CoreOS开源的CNI网络插件，功能是让集群中的不同节点主机创建的Docker容器都具有全集群唯一的虚拟IP地址。
#### Flannel架构图
![imges](https://github.com/cuiziwenn/imgesfile/blob/master/flannel%E7%BD%91%E7%BB%9C.png)
#### Calico
* Calico是适用于容器、虚拟机各裸机工作负载均衡的开源网络和网络安全解决方案，Calico 使用标准Linux 网络工具为云原生应用程序提供两项主要服务：1.工作负载之前的网络连接。2.在工作负载之间实施网络安全策略。
* 不像 Flannel, Calico 不使用 overlay 网络，而是使用 BGP 路由协议配置一个3层网络在主机之间路由数据包。这意味着在主机之间移动时，数据包不需要包装在额外的封装层中。 BGP路由机制可以直接引导数据包，而无需执行将流量包装在附加流量层中的额外步骤。
* 除了带来了更好的网络性能，也有一个好的点，当出现网络问题时它允许进行更常规的故障排除。 尽管使用VXLAN之类的技术封装的解决方案效果很好，但该过程处理数据包的方式可能会使跟踪变得困难。而使用Calico，标准的调试工具可以访问与简单环境中相同的信息，从而使更广泛的开发人员和管理员更容易理解如何排错。
* 对于网络策略也是 Calico 很受欢迎的功能之一。Calico还可以与服务网状网Istio集成，以便在服务网状层和网络基础架构层解释和实施群集内工作负载的策略。 这意味着您可以配置功能强大的规则，描述Pod应如何发送和接受流量，从而提高网络环境的安全性和可控性。
